<main>
  <input type="text" id="query" placeholder="ادخل رقم العضوية أو الاسم" autocomplete="off" />
  <button onclick="lookup()">استعلام</button>
  <div id="result"></div>
</main>

<script>
  function lookup() {
    const input = document.getElementById('query').value.trim();
    const resultDiv = document.getElementById('result');

    if (!input) {
      resultDiv.innerHTML = '<span class="error">من فضلك أدخل رقم العضوية أو الاسم</span>';
      return;
    }

    resultDiv.textContent = 'جاري البحث...';

    // لو كله أرقام = رقم عضوية، غير كده = اسم
    const isNumber = /^\d+$/.test(input);
    const param = isNumber ? `id=${encodeURIComponent(input)}` : `name=${encodeURIComponent(input)}`;

    fetch(`https://script.google.com/macros/s/AKfycbx2uR52ys_ax9mtOwcGgDdoojGmluP6G1XjZNg9igt4Sf_wfkyDcvGKYLayM8fyKmUyuA/exec?${param}`)
      .then(response => response.json())
      .then(data => {
        if (data.error) {
          resultDiv.innerHTML = `<span class="error">❌ ${data.error}</span>`;
        } else {
          resultDiv.textContent = `✅ الاسم: ${data.name}\n🚌 رقم الأتوبيس: ${data.bus}\n🪑 رقم الكرسي: ${data.seat}`;
        }
      })
      .catch(() => {
        resultDiv.innerHTML = '<span class="error">حدث خطأ في الاتصال. حاول مرة أخرى.</span>';
      });
  }
</script>
